# プロジェクト概要

日本語音声をリアルタイムで英語に翻訳し、ブラウザ上に表示するWebアプリケーション。

## 主要機能

- 日本語音声 → 英語テキストのリアルタイム翻訳
- WebSocketによる双方向通信
- ブラウザ上での翻訳結果表示（大画面想定）

## 技術スタック

- バックエンド: FastAPI + OpenAI Whisper (small model)
- フロントエンド: HTML + JavaScript (Vanilla)
- 通信: WebSocket
- 音声入力: MediaRecorder API

---

# M1: Whisperバックエンド（基本API）

## 目的
Whisperを使って音声ファイルを翻訳する最小構成のFastAPIアプリを構築。

## 要件
- FastAPIを使用
- エンドポイント `POST /translate`: 音声ファイル（WAV/MP3等）を受け取り
- Whisperの "small" モデルをロード
- `task="translate"`, `language="ja"` で日本語→英語翻訳
- レスポンス: `{"translation": "translated text"}`
- 外部APIは使用しない（openai-whisperのみ）
- Python 3.10+で動作

## 動作例
```bash
curl -X POST -F "file=@sample.wav" http://localhost:8000/translate
```

## 依存関係
- `fastapi`, `uvicorn`, `openai-whisper`, `python-multipart`

---

# M2: WebSocket通信でリアルタイム翻訳

## 目的
M1を拡張し、WebSocket経由で音声をリアルタイム翻訳。

## 要件
- WebSocketエンドポイント `/ws` を作成
- クライアントから音声データ（バイト列）を定期的に受信
- サーバ起動時にWhisperモデルをロードしてキャッシュ（app.state使用）
- 各チャンク受信時に非同期で翻訳処理
- Whisperで日本語文字起こしと英語翻訳の両方を取得
  - `task="transcribe"`, `language="ja"` で日本語文字起こし
  - `task="translate"`, `language="ja"` で日本語→英語翻訳
- レスポンス: `{"japanese": "日本語テキスト", "english": "translated text"}`

## 技術詳細
- 音声処理は `asyncio.to_thread` で非同期化
- ffmpegでWebM/OGG → WAV変換を挟んで安定性向上
- M1との互換性を維持
- 1つの音声チャンクに対してWhisperを2回実行（日本語transcription + 英語translation）

---

# M3: フロントエンドの構築（リアルタイム翻訳表示）

## 目的
M2のWebSocketサーバに接続し、マイク音声を送信して翻訳結果をブラウザに表示。

## UI仕様

### 音声入力
- **ボタンでON/OFF切り替え**（デフォルト: OFF）
- MediaRecorder APIでマイク録音
- 一定間隔（例: 10秒）ごとに音声チャンクをWebSocketで送信

### 翻訳結果表示
- **2カラムレイアウト**: 画面を左右に分割
  - **左側**: 日本語の文字起こし（transcription）
  - **右側**: 英語の翻訳結果（translation）
- **リアルタイムで追記**: WebSocketから受信次第、画面に表示
- **自動スクロール**: 常に最新の翻訳結果が画面に表示される
- **改行ロジック**:
  - 日本語: 句読点（`。`、`！`、`？`）で改行
  - 英語: ピリオド(`.`)、疑問符(`?`)、感嘆符(`!`) + スペースで改行
- **クリアボタン**: 表示内容をリセット可能
- **文字サイズ選択機能**: 大画面での表示を想定し、フォントサイズを変更可能

### レイアウト
- **大画面表示を想定**: 画面全体を使って翻訳結果を表示
- **2カラム構成**: 左右均等に分割され、それぞれ独立してスクロール可能
- **シンプルなデザイン**: ボタン類はヘッダーに配置、翻訳結果エリアは最大化
- **録音中インジケーター**: 録音中であることを視覚的に示す（色変化など）

## 機能一覧

1. **Start/Stop録音ボタン**
2. **翻訳結果表示エリア**（自動スクロール、改行処理付き）
3. **クリアボタン**（翻訳結果をリセット）
4. **文字サイズ選択**（ドロップダウンまたはボタン）
5. **録音状態インジケーター**

## 削除した機能（旧M3から）

- PDFアップロード機能
- PDF表示機能（pdf.js）
- スライドナビゲーション機能

## 出力形式
- ファイル名: `index.html`
- HTML + JavaScript (Vanilla)
- 実行すれば即動く形
- 主要箇所にコメントを付ける

---

# エンドポイント一覧

| エンドポイント | メソッド | 説明 |
|--------------|---------|------|
| `/` | GET | index.htmlを提供 |
| `/translate` | POST | 音声ファイルを翻訳（単発） |
| `/ws` | WebSocket | リアルタイム翻訳 |
| `/health` | GET | ヘルスチェック |
